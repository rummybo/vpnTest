<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>前端导航页管理</title>
<style>body{font-family:Arial,sans-serif;margin:20px;background:#f5f5f5}.container{background:white;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}.btn{padding:8px 16px;margin:4px;border:1px solid #ddd;background:white;cursor:pointer;border-radius:4px}.btn-primary{background:#007bff;color:white;border-color:#007bff}.table{width:100%;border-collapse:collapse;margin-top:20px}.table th,.table td{padding:8px;border:1px solid #ddd;text-align:left}.table th{background:#f8f9fa}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000}.modal-content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:8px;width:400px}.form-group{margin:10px 0}.form-control{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box}.alert{padding:10px;margin:10px 0;border-radius:4px}.alert-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.alert-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}</style>
</head><body>
<div class="container">
<h1>前端导航页管理</h1>
<button class="btn btn-primary" onclick="showAdd()">添加导航页</button>
<button class="btn" onclick="load()">刷新</button>
<div id="msg"></div>
<div id="content">加载中...</div>
</div>

<div id="modal" class="modal">
<div class="modal-content">
<h3 id="title">添加导航页</h3>
<div class="form-group">
<label>名称*</label>
<input type="text" id="name" class="form-control" required>
</div>
<div class="form-group">
<label>图标</label>
<div style="display:flex;gap:8px">
<input type="text" id="icon" class="form-control" placeholder="fa fa-home 或上传图片">
<button type="button" class="btn" onclick="uploadIcon()">上传图标</button>
</div>
<input type="file" id="iconFile" accept="image/*" style="display:none" onchange="handleUpload(this)">
<div id="iconPreview" style="margin-top:8px;display:none;padding:8px;background:#f9f9f9;border-radius:4px;font-size:12px">
<strong>预览：</strong><span id="previewContent"></span>
</div>
</div>
<div class="form-group">
<label>URL*</label>
<input type="url" id="url" class="form-control" required>
</div>
<div class="form-group">
<label>排序</label>
<input type="number" id="sort" class="form-control" value="0">
</div>
<div class="form-group">
<label>状态</label>
<select id="status" class="form-control">
<option value="active">启用</option>
<option value="inactive">禁用</option>
</select>
</div>
<button class="btn btn-primary" onclick="save()">保存</button>
<button class="btn" onclick="hide()">取消</button>
</div>
</div>

<script>
let editId=null,data=[];
const api='/api/v1/149544e4';

function getAuthToken(){
return localStorage.getItem('authorization');
}

function getHeaders(includeContentType=true){
const headers={
'Accept':'application/json',
'Authorization':getAuthToken()
};
if(includeContentType){
headers['Content-Type']='application/json';
}
return headers;
}

function msg(text,type='success'){
document.getElementById('msg').innerHTML=`<div class="alert alert-${type}">${text}</div>`;
setTimeout(()=>document.getElementById('msg').innerHTML='',3000);
}

async function load(){
try{
const res=await fetch(`${api}/frontend_nav_pages/fetch`,{
method:'GET',
headers:getHeaders(),
credentials:'include'
});
if(!res.ok)throw new Error('HTTP '+res.status);
const result=await res.json();
data=result.data||[];
render();
}catch(e){
msg('加载失败: '+e.message,'error');
document.getElementById('content').innerHTML='<p>加载失败</p>';
}
}

function render(){
if(data.length===0){
document.getElementById('content').innerHTML='<p>暂无数据</p>';
return;
}
let html='<table class="table"><tr><th>ID</th><th>名称</th><th>图标</th><th>URL</th><th>排序</th><th>状态</th><th>操作</th></tr>';
data.forEach(item=>{
const iconDisplay=item.icon?(item.icon.startsWith('http')?`<img src="${item.icon}" style="width:24px;height:24px;object-fit:cover;border-radius:4px;margin-right:8px"> ${item.icon.length>30?item.icon.substr(0,30)+'...':item.icon}`:`<i class="${item.icon}" style="font-size:18px;margin-right:8px"></i> ${item.icon}`):'-';
html+=`<tr>
<td>${item.id}</td>
<td>${item.name}</td>
<td>${iconDisplay}</td>
<td><a href="${item.url}" target="_blank">${item.url.length>30?item.url.substr(0,30)+'...':item.url}</a></td>
<td>${item.sort}</td>
<td>${item.status=='active'?'启用':'禁用'}</td>
<td>
<button class="btn" onclick="edit(${item.id})">编辑</button>
<button class="btn" onclick="del(${item.id})">删除</button>
</td>
</tr>`;
});
html+='</table>';
document.getElementById('content').innerHTML=html;
}

function showAdd(){
editId=null;
document.getElementById('title').textContent='添加导航页';
document.getElementById('name').value='';
document.getElementById('icon').value='';
document.getElementById('url').value='';
document.getElementById('sort').value='0';
document.getElementById('status').value='active';
document.getElementById('iconPreview').style.display='none';
document.getElementById('modal').style.display='block';
}

function edit(id){
const item=data.find(x=>x.id===id);
if(!item)return;
editId=id;
document.getElementById('title').textContent='编辑导航页';
document.getElementById('name').value=item.name;
document.getElementById('icon').value=item.icon||'';
document.getElementById('url').value=item.url;
document.getElementById('sort').value=item.sort;
document.getElementById('status').value=item.status;
updatePreview(item.icon||'');
document.getElementById('modal').style.display='block';
}

async function save(){
const name=document.getElementById('name').value.trim();
const icon=document.getElementById('icon').value.trim();
const url=document.getElementById('url').value.trim();
const sort=parseInt(document.getElementById('sort').value)||0;
const status=document.getElementById('status').value;
if(!name||!url){
msg('请填写必填字段','error');
return;
}
try{
const body={name,icon,url,sort,status};
if(editId)body.id=editId;
const res=await fetch(`${api}/frontend_nav_pages/save`,{
method:'POST',
headers:getHeaders(),
credentials:'include',
body:JSON.stringify(body)
});
if(!res.ok)throw new Error('HTTP '+res.status);
const result=await res.json();
if(result.message&&!result.message.includes('失败')){
msg(editId?'更新成功':'添加成功');
hide();
load();
}else{
throw new Error(result.message||'保存失败');
}
}catch(e){
msg('保存失败: '+e.message,'error');
}
}

async function del(id){
if(!confirm('确定删除？'))return;
try{
const res=await fetch(`${api}/frontend_nav_pages/drop`,{
method:'POST',
headers:getHeaders(),
credentials:'include',
body:JSON.stringify({id})
});
if(!res.ok)throw new Error('HTTP '+res.status);
const result=await res.json();
if(result.message&&!result.message.includes('失败')){
msg('删除成功');
load();
}else{
throw new Error(result.message||'删除失败');
}
}catch(e){
msg('删除失败: '+e.message,'error');
}
}

function hide(){
document.getElementById('modal').style.display='none';
}

function uploadIcon(){
document.getElementById('iconFile').click();
}

async function handleUpload(input){
const file=input.files[0];
if(!file)return;
if(file.size>2*1024*1024){
msg('图片大小不能超过2MB','error');
return;
}
const allowedTypes=['image/jpeg','image/png','image/jpg','image/gif','image/svg+xml'];
if(!allowedTypes.includes(file.type)){
msg('只支持 JPG, PNG, GIF, SVG 格式','error');
return;
}
const formData=new FormData();
formData.append('file',file);
try{
msg('正在上传图标...');
const res=await fetch(`${api}/upload/image`,{
method:'POST',
headers:getHeaders(false),
credentials:'include',
body:formData
});
if(!res.ok)throw new Error('HTTP '+res.status);
const result=await res.json();
if(result.url){
document.getElementById('icon').value=result.url;
updatePreview(result.url);
msg('图标上传成功');
}else{
throw new Error(result.message||'上传失败');
}
}catch(e){
msg('图标上传失败: '+e.message,'error');
}
input.value='';
}

function updatePreview(iconValue){
const preview=document.getElementById('iconPreview');
const content=document.getElementById('previewContent');
if(!iconValue){
preview.style.display='none';
return;
}
preview.style.display='block';
if(iconValue.startsWith('http')){
content.innerHTML=`<img src="${iconValue}" style="width:20px;height:20px;object-fit:cover;border-radius:3px;margin-right:8px;vertical-align:middle"> ${iconValue.length>50?iconValue.substr(0,50)+'...':iconValue}`;
}else{
content.innerHTML=`<i class="${iconValue}" style="font-size:16px;margin-right:8px"></i> ${iconValue}`;
}
}

document.addEventListener('DOMContentLoaded',function(){
load();
const iconInput=document.getElementById('icon');
if(iconInput){
iconInput.addEventListener('input',function(e){
updatePreview(e.target.value);
});
}
});
document.getElementById('modal').onclick=function(e){
if(e.target===this)hide();
};
</script>
</body></html>